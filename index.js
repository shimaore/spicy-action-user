// Generated by CoffeeScript 1.12.7
(function() {
  var LRU, PouchDB, debug, seem,
    hasProp = {}.hasOwnProperty,
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  seem = require('seem');

  PouchDB = require('ccnq4-pouchdb');

  LRU = require('lru');

  this.name = (require('./package')).name;

  debug = (require('debug'))(this.name);

  this.include = function() {
    var base, prefix, ref, user_db, users;
    if (((ref = this.cfg.users) != null ? ref.db : void 0) == null) {
      return;
    }
    prefix = (base = this.cfg.users).prefix != null ? base.prefix : base.prefix = 'org.couchdb.user';
    user_db = new PouchDB(this.cfg.users.db);
    users = new LRU(500);
    this.helper({
      get_user: function() {
        var _id, data, name;
        if (this.session.couchdb_username == null) {
          return null;
        }
        name = this.session.couchdb_username;
        _id = [prefix, name].join(':');
        debug('get_user', {
          name: name,
          _id: _id
        });
        data = users.get(_id);
        if (data != null) {
          return Promise.resolve(data);
        }
        return user_db.get(_id)["catch"](function() {
          return {
            _id: _id,
            name: name,
            roles: [],
            type: 'user'
          };
        }).then(function(data) {
          users.set(_id, data);
          return data;
        });
      }
    });
    this.helper({
      save_user: seem(function*() {
        var doc, k, ref1, v;
        if (this.session.couchdb_username == null) {
          return {};
        }
        doc = (yield this.get_user());
        doc.locale = this.session.locale;
        doc.timezone = this.session.timezone;
        if ((doc.database == null) && (this.session.database != null)) {
          doc.database = this.session.database;
        }
        if (this.session.user_params != null) {
          if (doc.params == null) {
            doc.params = {};
          }
          ref1 = this.session.user_params;
          for (k in ref1) {
            if (!hasProp.call(ref1, k)) continue;
            v = ref1[k];
            doc.params[k] = v;
          }
        }
        debug('save_user', doc);
        return user_db.put(doc);
      })
    });
    this.helper({
      load_user: seem(function*() {
        var base1, base2, base3, base4, base5, doc, i, len, r, ref1, ref2, ref3;
        if (((ref1 = this.session) != null ? ref1.couchdb_username : void 0) == null) {
          return;
        }
        if (((ref2 = this.cfg.users) != null ? ref2.db : void 0) == null) {
          return;
        }
        doc = (yield this.get_user());
        if ((base1 = this.session).locale == null) {
          base1.locale = doc.locale;
        }
        if ((base2 = this.session).timezone == null) {
          base2.timezone = doc.timezone;
        }
        if ((base3 = this.session).database == null) {
          base3.database = doc.database;
        }
        if ((base4 = this.session).user_params == null) {
          base4.user_params = doc.params;
        }
        if (doc.roles != null) {
          if ((base5 = this.session).couchdb_roles == null) {
            base5.couchdb_roles = [];
          }
          ref3 = doc.roles;
          for (i = 0, len = ref3.length; i < len; i++) {
            r = ref3[i];
            if (indexOf.call(this.session.couchdb_roles, r) < 0) {
              this.session.couchdb_roles.push(r);
            }
          }
        }
      })
    });
    this.on('set_user_param', seem(function*(name, value) {
      var base1, res;
      if (!((name != null) && typeof name === 'string')) {
        this.ack({
          failed: true
        });
        return;
      }
      if ((base1 = this.session).user_params == null) {
        base1.user_params = {};
      }
      this.session.user_params[name] = value;
      res = (yield this.save_user()["catch"]({}));
      return this.ack(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
    this.on('set_locale', seem(function*(locale) {
      var res;
      this.session.locale = locale;
      res = (yield this.save_user()["catch"]({}));
      return this.ack(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
    this.put('/locale/:locale', seem(function*() {
      var res;
      this.session.locale = this.params.locale;
      res = (yield this.save_user()["catch"]({}));
      return this.json(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
    this.on('set_timezone', seem(function*(timezone) {
      var res;
      this.session.timezone = timezone;
      res = (yield this.save_user()["catch"]({}));
      return this.ack(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
    return this.put('/timezone/:timezone', seem(function*() {
      var res;
      this.session.timezone = this.params.locale;
      res = (yield this.save_user()["catch"]({}));
      return this.json(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
  };

  this.middleware = seem(function*() {
    yield this.load_user()["catch"](function(error) {
      return debug("load_user failed: " + error);
    });
    return this.next();
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC5jb2ZmZWUubWQiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFJO0FBQUEsTUFBQSx5QkFBQTtJQUFBOzs7RUFBQSxJQUFBLEdBQU8sT0FBQSxDQUFRLE1BQVI7O0VBQ1AsT0FBQSxHQUFVLE9BQUEsQ0FBUSxlQUFSOztFQUNWLEdBQUEsR0FBTSxPQUFBLENBQVEsS0FBUjs7RUFFTixJQUFDLENBQUEsSUFBRCxHQUFRLENBQUMsT0FBQSxDQUFRLFdBQVIsQ0FBRCxDQUFxQixDQUFDOztFQUM5QixLQUFBLEdBQVEsQ0FBQyxPQUFBLENBQVEsT0FBUixDQUFELENBQUEsQ0FBa0IsSUFBQyxDQUFBLElBQW5COztFQUVSLElBQUMsQ0FBQSxPQUFELEdBQVcsU0FBQTtBQUVULFFBQUE7SUFBQSxJQUFjLDBEQUFkO0FBQUEsYUFBQTs7SUFFQSxNQUFBLGdEQUFtQixDQUFDLGFBQUQsQ0FBQyxTQUFVO0lBRTlCLE9BQUEsR0FBVSxJQUFJLE9BQUosQ0FBWSxJQUFDLENBQUEsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUF2QjtJQUlWLEtBQUEsR0FBUSxJQUFJLEdBQUosQ0FBUSxHQUFSO0lBRVIsSUFBQyxDQUFBLE1BQUQsQ0FBUTtNQUFBLFFBQUEsRUFBVSxTQUFBO0FBQ2hCLFlBQUE7UUFBQSxJQUFPLHFDQUFQO0FBQ0UsaUJBQU8sS0FEVDs7UUFHQSxJQUFBLEdBQU8sSUFBQyxDQUFBLE9BQU8sQ0FBQztRQUNoQixHQUFBLEdBQU0sQ0FBQyxNQUFELEVBQVEsSUFBUixDQUFhLENBQUMsSUFBZCxDQUFtQixHQUFuQjtRQUNOLEtBQUEsQ0FBTSxVQUFOLEVBQWtCO1VBQUMsTUFBQSxJQUFEO1VBQU0sS0FBQSxHQUFOO1NBQWxCO1FBRUEsSUFBQSxHQUFPLEtBQUssQ0FBQyxHQUFOLENBQVUsR0FBVjtRQUNQLElBQStCLFlBQS9CO0FBQUEsaUJBQU8sT0FBTyxDQUFDLE9BQVIsQ0FBZ0IsSUFB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LENBQUssVUFBQTtBQUMvQixVQUFBO01BQUEsSUFBQyxDQUFBLE9BQU8sQ0FBQyxRQUFULEdBQW9CLElBQUMsQ0FBQSxNQUFNLENBQUM7TUFDNUIsR0FBQSxHQUFNLENBQUEsTUFBTSxJQUFDLENBQUEsU0FBRCxDQUFBLENBQVksRUFBQyxLQUFELEVBQVosQ0FBbUIsRUFBbkIsQ0FBTjthQUNOLElBQUMsQ0FBQSxJQUFELENBQVMsR0FBRyxDQUFDLEVBQVAsR0FBZTtRQUFBLEVBQUEsRUFBRyxJQUFIO09BQWYsR0FBNEI7UUFBQSxNQUFBLEVBQU8sSUFBUDtPQUFsQztJQUgrQixDQUFMLENBQTVCO0VBMUhTOztFQW9JWCxJQUFDLENBQUEsVUFBRCxHQUFjLElBQUEsQ0FBSyxVQUFBO0lBRWpCLE1BQU0sSUFBQyxDQUFBLFNBQUQsQ0FBQSxDQUNKLEVBQUMsS0FBRCxFQURJLENBQ0csU0FBQyxLQUFEO2FBQ0wsS0FBQSxDQUFNLG9CQUFBLEdBQXFCLEtBQTNCO0lBREssQ0FESDtXQUlOLElBQUMsQ0FBQSxJQUFELENBQUE7RUFOaUIsQ0FBTDtBQTNJZCIsInNvdXJjZXNDb250ZW50IjpbIiAgICBzZWVtID0gcmVxdWlyZSAnc2VlbSdcbiAgICBQb3VjaERCID0gcmVxdWlyZSAnY2NucTQtcG91Y2hkYidcbiAgICBMUlUgPSByZXF1aXJlICdscnUnXG5cbiAgICBAbmFtZSA9IChyZXF1aXJlICcuL3BhY2thZ2UnKS5uYW1lXG4gICAgZGVidWcgPSAocmVxdWlyZSAnZGVidWcnKSBAbmFtZVxuXG4gICAgQGluY2x1ZGUgPSAtPlxuXG4gICAgICByZXR1cm4gdW5sZXNzIEBjZmcudXNlcnM/LmRiP1xuXG4gICAgICBwcmVmaXggPSBAY2ZnLnVzZXJzLnByZWZpeCA/PSAnb3JnLmNvdWNoZGIudXNlcidcblxuICAgICAgdXNlcl9kYiA9IG5ldyBQb3VjaERCIEBjZmcudXNlcnMuZGJcblxuKiBkb2MudXNlci5faWQgKHN0cmluZykgYDxjZmcudXNlcnMucHJlZml4Pjo8Y291Y2hkYl91c2VybmFtZT5gXG5cbiAgICAgIHVzZXJzID0gbmV3IExSVSA1MDBcblxuICAgICAgQGhlbHBlciBnZXRfdXNlcjogLT5cbiAgICAgICAgdW5sZXNzIEBzZXNzaW9uLmNvdWNoZGJfdXNlcm5hbWU/XG4gICAgICAgICAgcmV0dXJuIG51bGxcblxuICAgICAgICBuYW1lID0gQHNlc3Npb24uY291Y2hkYl91c2VybmFtZVxuICAgICAgICBfaWQgPSBbcHJlZml4LG5hbWVdLmpvaW4gJzonXG4gICAgICAgIGRlYnVnICdnZXRfdXNlcicsIHtuYW1lLF9pZH1cblxuICAgICAgICBkYXRhID0gdXNlcnMuZ2V0IF9pZFxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlIGRhdGEgaWYgZGF0YT9cblxuICAgICAgICB1c2VyX2RiXG4gICAgICAgICAgLmdldCBfaWRcbiAgICAgICAgICAuY2F0Y2ggLT4ge19pZCxuYW1lLHJvbGVzOltdLHR5cGU6J3VzZXInfVxuICAgICAgICAgIC50aGVuIChkYXRhKSAtPlxuICAgICAgICAgICAgdXNlcnMuc2V0IF9pZCwgZGF0YVxuICAgICAgICAgICAgZGF0YVxuXG4gICAgICBAaGVscGVyIHNhdmVfdXNlcjogc2VlbSAtPlxuICAgICAgICB1bmxlc3MgQHNlc3Npb24uY291Y2hkYl91c2VybmFtZT9cbiAgICAgICAgICByZXR1cm4ge31cblxuICAgICAgICBkb2MgPSB5aWVsZCBAZ2V0X3VzZXIoKVxuXG4gICAgICAgIGRvYy5sb2NhbGUgPSBAc2Vzc2lvbi5sb2NhbGVcbiAgICAgICAgZG9jLnRpbWV6b25lID0gQHNlc3Npb24udGltZXpvbmVcbiAgICAgICAgaWYgbm90IGRvYy5kYXRhYmFzZT8gYW5kIEBzZXNzaW9uLmRhdGFiYXNlP1xuICAgICAgICAgIGRvYy5kYXRhYmFzZSA9IEBzZXNzaW9uLmRhdGFiYXNlXG4gICAgICAgIGlmIEBzZXNzaW9uLnVzZXJfcGFyYW1zP1xuICAgICAgICAgIGRvYy5wYXJhbXMgPz0ge31cbiAgICAgICAgICBmb3Igb3duIGssdiBvZiBAc2Vzc2lvbi51c2VyX3BhcmFtc1xuICAgICAgICAgICAgZG9jLnBhcmFtc1trXSA9IHZcblxuICAgICAgICBkZWJ1ZyAnc2F2ZV91c2VyJywgZG9jXG5cbiAgICAgICAgdXNlcl9kYlxuICAgICAgICAgIC5wdXQgZG9jXG5cbiAgICAgIEBoZWxwZXIgbG9hZF91c2VyOiBzZWVtIC0+XG4gICAgICAgIHVubGVzcyBAc2Vzc2lvbj8uY291Y2hkYl91c2VybmFtZT9cbiAgICAgICAgICByZXR1cm5cblxuICAgICAgICB1bmxlc3MgQGNmZy51c2Vycz8uZGI/XG4gICAgICAgICAgcmV0dXJuXG5cblJldHJpZXZlIENvdWNoREIgZGF0YSAobG9jYWxlLCB0aW1lem9uZSwgZXh0cmEgcm9sZXMpIGZvciB0aGUgdXNlci5cblxuKiBjZmcudXNlcnMuZGIgKFVSSSkgUG9pbnRzIHRvIHRoZSBgdXNlcnNgIGRhdGFiYXNlLCBpbmNsdWRpbmcgYXV0aGVudGljYXRpb24uXG4qIGNmZy51c2Vycy5wcmVmaXggKHN0cmluZykgUHJlZml4IGZvciB1c2VyIElEcyBbZGVmYXVsdDogYG9yZy5jb3VjaGRiLnVzZXJgXVxuXG4gICAgICAgIGRvYyA9IHlpZWxkIEBnZXRfdXNlcigpXG5cblRoZSB1c2VyIHJlY29yZCBtaWdodCBub3QgZXhpc3QsIG9yIG1pZ2h0IGJlIGVtcHR5LCBldGMuXG5cbiogZG9jLnVzZXIubG9jYWxlIChzdHJpbmcpIHVzZXIgbG9jYWxlXG4qIGRvYy51c2VyLnRpbWV6b25lIChzdHJpbmcpIHVzZXIgdGltZXpvbmVcbiogZG9jLnVzZXIuZGF0YWJhc2UgKHN0cmluZykgdXNlciBkYXRhYmFzZVxuKiBkb2MudXNlci5yb2xlcyAoYXJyYXkpIHVzZXIgcm9sZXNcbiogZG9jLnVzZXIucGFyYW1zIChvYmplY3QpIHVzZXIgcGVyc29uYWxpc2F0aW9uIHBhcmFtZXRlcnMgKGJleW9uZCBkb2MudXNlci5sb2NhbGUgYW5kIGRvYy51c2VyLnRpbWV6b25lKVxuKiBzZXNzaW9uLmxvY2FsZSB1c2VyIGxvY2FsZTsgaW5pdGlhbGl6ZWQgZnJvbSBkb2MudXNlci5sb2NhbGVcbiogc2Vzc2lvbi50aW1lem9uZSB1c2VyIHRpbWV6b25lOyBpbml0aWFsaXplZCBmcm9tIGRvYy51c2VyLnRpbWV6b25lXG4qIHNlc3Npb24uZGF0YWJhc2UgdXNlciBwcml2YXRlIGRhdGFiYXNlOyBpbml0aWFsaXplZCBmcm9tIGRvYy51c2VyLmRhdGFiYXNlXG4qIHNlc3Npb24udXNlcl9wYXJhbXMgdXNlciBwZXJzb25hbGl6YXRpb24gcGFyYW1ldGVyczsgaW5pdGlhbGl6ZWQgZnJvbSBkb2MudXNlci5wYXJhbXNcbiogc2Vzc2lvbi5jb3VjaGRiX3JvbGVzIGV4dGVuZGVkIGJ5IGRvYy51c2VyLnJvbGVzIChiZXlvbmQgdGhlIHJvbGVzIGF1dG9tYXRpY2FsbHkgYXNzaWduZWQgZWxzZXdoZXJlKVxuXG4gICAgICAgIEBzZXNzaW9uLmxvY2FsZSA/PSBkb2MubG9jYWxlXG4gICAgICAgIEBzZXNzaW9uLnRpbWV6b25lID89IGRvYy50aW1lem9uZVxuICAgICAgICBAc2Vzc2lvbi5kYXRhYmFzZSA/PSBkb2MuZGF0YWJhc2VcbiAgICAgICAgQHNlc3Npb24udXNlcl9wYXJhbXMgPz0gZG9jLnBhcmFtc1xuICAgICAgICBpZiBkb2Mucm9sZXM/XG4gICAgICAgICAgQHNlc3Npb24uY291Y2hkYl9yb2xlcyA/PSBbXVxuICAgICAgICAgIGZvciByIGluIGRvYy5yb2xlcyB3aGVuIHIgbm90IGluIEBzZXNzaW9uLmNvdWNoZGJfcm9sZXNcbiAgICAgICAgICAgIEBzZXNzaW9uLmNvdWNoZGJfcm9sZXMucHVzaCByXG5cbiAgICAgICAgcmV0dXJuXG5cblVzZXIgcGFyYW1ldGVyc1xuLS0tLS0tLS0tLS0tLS0tXG5cbiAgICAgIEBvbiAnc2V0X3VzZXJfcGFyYW0nLCBzZWVtIChuYW1lLHZhbHVlKSAtPlxuICAgICAgICB1bmxlc3MgbmFtZT8gYW5kIHR5cGVvZiBuYW1lIGlzICdzdHJpbmcnXG4gICAgICAgICAgQGFjayBmYWlsZWQ6dHJ1ZVxuICAgICAgICAgIHJldHVyblxuXG4gICAgICAgIEBzZXNzaW9uLnVzZXJfcGFyYW1zID89IHt9XG4gICAgICAgIEBzZXNzaW9uLnVzZXJfcGFyYW1zW25hbWVdID0gdmFsdWVcbiAgICAgICAgcmVzID0geWllbGQgQHNhdmVfdXNlcigpLmNhdGNoIHt9XG4gICAgICAgIEBhY2sgaWYgcmVzLm9rIHRoZW4gb2s6dHJ1ZSBlbHNlIGZhaWxlZDp0cnVlXG5cbkxvY2FsZVxuLS0tLS0tXG5cbiAgICAgIEBvbiAnc2V0X2xvY2FsZScsIHNlZW0gKGxvY2FsZSkgLT5cbiAgICAgICAgQHNlc3Npb24ubG9jYWxlID0gbG9jYWxlXG4gICAgICAgIHJlcyA9IHlpZWxkIEBzYXZlX3VzZXIoKS5jYXRjaCB7fVxuICAgICAgICBAYWNrIGlmIHJlcy5vayB0aGVuIG9rOnRydWUgZWxzZSBmYWlsZWQ6dHJ1ZVxuXG4gICAgICBAcHV0ICcvbG9jYWxlLzpsb2NhbGUnLCBzZWVtIC0+XG4gICAgICAgIEBzZXNzaW9uLmxvY2FsZSA9IEBwYXJhbXMubG9jYWxlXG4gICAgICAgIHJlcyA9IHlpZWxkIEBzYXZlX3VzZXIoKS5jYXRjaCB7fVxuICAgICAgICBAanNvbiBpZiByZXMub2sgdGhlbiBvazp0cnVlIGVsc2UgZmFpbGVkOnRydWVcblxuVGltZXpvbmVcbi0tLS0tLS0tXG5cbiAgICAgIEBvbiAnc2V0X3RpbWV6b25lJywgc2VlbSAodGltZXpvbmUpIC0+XG4gICAgICAgIEBzZXNzaW9uLnRpbWV6b25lID0gdGltZXpvbmVcbiAgICAgICAgcmVzID0geWllbGQgQHNhdmVfdXNlcigpLmNhdGNoIHt9XG4gICAgICAgIEBhY2sgaWYgcmVzLm9rIHRoZW4gb2s6dHJ1ZSBlbHNlIGZhaWxlZDp0cnVlXG5cbiAgICAgIEBwdXQgJy90aW1lem9uZS86dGltZXpvbmUnLCBzZWVtIC0+XG4gICAgICAgIEBzZXNzaW9uLnRpbWV6b25lID0gQHBhcmFtcy5sb2NhbGVcbiAgICAgICAgcmVzID0geWllbGQgQHNhdmVfdXNlcigpLmNhdGNoIHt9XG4gICAgICAgIEBqc29uIGlmIHJlcy5vayB0aGVuIG9rOnRydWUgZWxzZSBmYWlsZWQ6dHJ1ZVxuXG5NaWRkbGV3YXJlXG49PT09PT09PT09XG5cbkluamVjdCBgbG9jYWxlYCwgYHRpbWV6b25lYCwgYGRhdGFiYXNlYCwgYW5kIGB1c2VyX3BhcmFtc2AgaW50byB0aGUgc2Vzc2lvbi5cblxuICAgIEBtaWRkbGV3YXJlID0gc2VlbSAtPlxuXG4gICAgICB5aWVsZCBAbG9hZF91c2VyKClcbiAgICAgICAgLmNhdGNoIChlcnJvcikgLT5cbiAgICAgICAgICBkZWJ1ZyBcImxvYWRfdXNlciBmYWlsZWQ6ICN7ZXJyb3J9XCJcblxuICAgICAgQG5leHQoKVxuIl19
//# sourceURL=/srv/home/stephane/Artisan/Managed/Telecoms/spicy-action-user/index.coffee.md