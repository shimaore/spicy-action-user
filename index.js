// Generated by CoffeeScript 1.12.7
(function() {
  var LRU, PouchDB, debug, seem,
    hasProp = {}.hasOwnProperty,
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  seem = require('seem');

  PouchDB = require('ccnq4-pouchdb');

  LRU = require('lru');

  this.name = (require('./package')).name;

  debug = (require('debug'))(this.name);

  this.include = function() {
    var base, prefix, ref, user_db, users;
    if (((ref = this.cfg.users) != null ? ref.db : void 0) == null) {
      return;
    }
    prefix = (base = this.cfg.users).prefix != null ? base.prefix : base.prefix = 'org.couchdb.user';
    user_db = new PouchDB(this.cfg.users.db);
    users = new LRU(500);
    this.helper({
      get_user: function() {
        var _id, data, name;
        if (this.session.couchdb_username == null) {
          return null;
        }
        name = this.session.couchdb_username;
        _id = [prefix, name].join(':');
        debug('get_user', {
          name: name,
          _id: _id
        });
        data = users.get(_id);
        if (data != null) {
          return Promise.resolve(data);
        }
        return user_db.get(_id)["catch"](function() {
          return {
            _id: _id,
            name: name,
            roles: [],
            type: 'user'
          };
        }).then(function(data) {
          users.set(_id, data);
          return data;
        });
      }
    });
    this.helper({
      save_user: seem(function*() {
        var changes, doc, k, ref1, v;
        if (this.session.couchdb_username == null) {
          return {};
        }
        doc = (yield this.get_user());
        changes = false;
        changes || (changes = doc.locale !== this.session.locale);
        doc.locale = this.session.locale;
        changes || (changes = doc.timezone !== this.session.timezone);
        doc.timezone = this.session.timezone;
        if ((doc.database == null) && (this.session.database != null)) {
          changes || (changes = doc.database !== this.session.database);
          doc.database = this.session.database;
        }
        if (this.session.user_params != null) {
          if (doc.params == null) {
            doc.params = {};
          }
          ref1 = this.session.user_params;
          for (k in ref1) {
            if (!hasProp.call(ref1, k)) continue;
            v = ref1[k];
            changes || (changes = doc.params[k] !== v);
            doc.params[k] = v;
          }
        }
        debug('save_user', doc);
        if (!changes) {
          return;
        }
        return user_db.put(doc);
      })
    });
    this.helper({
      load_user: seem(function*() {
        var base1, base2, base3, base4, base5, doc, i, len, r, ref1, ref2, ref3;
        if (((ref1 = this.session) != null ? ref1.couchdb_username : void 0) == null) {
          return;
        }
        if (((ref2 = this.cfg.users) != null ? ref2.db : void 0) == null) {
          return;
        }
        doc = (yield this.get_user());
        if ((base1 = this.session).locale == null) {
          base1.locale = doc.locale;
        }
        if ((base2 = this.session).timezone == null) {
          base2.timezone = doc.timezone;
        }
        if ((base3 = this.session).database == null) {
          base3.database = doc.database;
        }
        if ((base4 = this.session).user_params == null) {
          base4.user_params = doc.params;
        }
        if (doc.roles != null) {
          if ((base5 = this.session).couchdb_roles == null) {
            base5.couchdb_roles = [];
          }
          ref3 = doc.roles;
          for (i = 0, len = ref3.length; i < len; i++) {
            r = ref3[i];
            if (indexOf.call(this.session.couchdb_roles, r) < 0) {
              this.session.couchdb_roles.push(r);
            }
          }
        }
      })
    });
    this.on('set_user_param', seem(function*(name, value) {
      var base1, res;
      if (!((name != null) && typeof name === 'string')) {
        this.ack({
          failed: true
        });
        return;
      }
      if ((base1 = this.session).user_params == null) {
        base1.user_params = {};
      }
      this.session.user_params[name] = value;
      res = (yield this.save_user()["catch"]({}));
      return this.ack(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
    this.on('set_locale', seem(function*(locale) {
      var res;
      this.session.locale = locale;
      res = (yield this.save_user()["catch"]({}));
      return this.ack(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
    this.put('/locale/:locale', seem(function*() {
      var locale, res;
      locale = this.params.locale;
      this.session.locale = locale;
      res = (yield this.save_user()["catch"]({}));
      return this.json(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
    this.on('set_timezone', seem(function*(timezone) {
      var res;
      this.session.timezone = timezone;
      res = (yield this.save_user()["catch"]({}));
      return this.ack(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
    return this.put('/timezone/:timezone', seem(function*() {
      var res, timezone;
      timezone = this.params.timezone;
      this.session.timezone = timezone;
      res = (yield this.save_user()["catch"]({}));
      return this.json(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
  };

  this.middleware = seem(function*() {
    yield this.load_user()["catch"](function(error) {
      return debug("load_user failed: " + error);
    });
    return this.next();
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC5jb2ZmZWUubWQiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFJO0FBQUEsTUFBQSx5QkFBQTtJQUFBOzs7RUFBQSxJQUFBLEdBQU8sT0FBQSxDQUFRLE1BQVI7O0VBQ1AsT0FBQSxHQUFVLE9BQUEsQ0FBUSxlQUFSOztFQUNWLEdBQUEsR0FBTSxPQUFBLENBQVEsS0FBUjs7RUFFTixJQUFDLENBQUEsSUFBRCxHQUFRLENBQUMsT0FBQSxDQUFRLFdBQVIsQ0FBRCxDQUFxQixDQUFDOztFQUM5QixLQUFBLEdBQVEsQ0FBQyxPQUFBLENBQVEsT0FBUixDQUFELENBQUEsQ0FBa0IsSUFBQyxDQUFBLElBQW5COztFQUVSLElBQUMsQ0FBQSxPQUFELEdBQVcsU0FBQTtBQUVULFFBQUE7SUFBQSxJQUFjLDBEQUFkO0FBQUEsYUFBQTs7SUFFQSxNQUFBLGdEQUFtQixDQUFDLGFBQUQsQ0FBQyxTQUFVO0lBRTlCLE9BQUEsR0FBVSxJQUFJLE9BQUosQ0FBWSxJQUFDLENBQUEsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUF2QjtJQUlWLEtBQUEsR0FBUSxJQUFJLEdBQUosQ0FBUSxHQUFSO0lBRVIsSUFBQyxDQUFBLE1BQUQsQ0FBUTtNQUFBLFFBQUEsRUFBVSxTQUFBO0FBQ2hCLFlBQUE7UUFBQSxJQUFPLHFDQUFQO0FBQ0UsaUJBQU8sS0FEVDs7UUFHQSxJQUFBLEdBQU8sSUFBQyxDQUFBLE9BQU8sQ0FBQztRQUNoQixHQUFBLEdBQU0sQ0FBQyxNQUFELEVBQVEsSUFBUixDQUFhLENBQUMsSUFBZCxDQUFtQixHQUFuQjtRQUNOLEtBQUEsQ0FBTSxVQUFOLEVBQWtCO1VBQUMsTUFBQSxJQUFEO1VBQU0sS0FBQSxHQUFOO1NBQWxCO1FBRUEsSUFBQSxHQUFPLEtBQUssQ0FBQyxHQUFOLENBQVUsR0FBVjtRQUNQLElBQStCLFlBQS9CO0FBQUEsaUJBQU8sT0FBTyxDQUFDLE9BQVIsQ0FBZ0IsSUFB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LENBQUEsT0FBTyxDQUFDLFFBQVQsR0FBb0I7TUFDcEIsR0FBQSxHQUFNLENBQUEsTUFBTSxJQUFDLENBQUEsU0FBRCxDQUFBLENBQVksRUFBQyxLQUFELEVBQVosQ0FBbUIsRUFBbkIsQ0FBTjthQUNOLElBQUMsQ0FBQSxHQUFELENBQVEsR0FBRyxDQUFDLEVBQVAsR0FBZTtRQUFBLEVBQUEsRUFBRyxJQUFIO09BQWYsR0FBNEI7UUFBQSxNQUFBLEVBQU8sSUFBUDtPQUFqQztJQUh1QixDQUFMLENBQXBCO1dBS0EsSUFBQyxDQUFBLEdBQUQsQ0FBSyxxQkFBTCxFQUE0QixJQUFBLENBQUssVUFBQTtBQUMvQixVQUFBO01BQUMsV0FBWSxJQUFDLENBQUE7TUFDZCxJQUFDLENBQUEsT0FBTyxDQUFDLFFBQVQsR0FBb0I7TUFDcEIsR0FBQSxHQUFNLENBQUEsTUFBTSxJQUFDLENBQUEsU0FBRCxDQUFBLENBQVksRUFBQyxLQUFELEVBQVosQ0FBbUIsRUFBbkIsQ0FBTjthQUNOLElBQUMsQ0FBQSxJQUFELENBQVMsR0FBRyxDQUFDLEVBQVAsR0FBZTtRQUFBLEVBQUEsRUFBRyxJQUFIO09BQWYsR0FBNEI7UUFBQSxNQUFBLEVBQU8sSUFBUDtPQUFsQztJQUorQixDQUFMLENBQTVCO0VBdElTOztFQWlKWCxJQUFDLENBQUEsVUFBRCxHQUFjLElBQUEsQ0FBSyxVQUFBO0lBRWpCLE1BQU0sSUFBQyxDQUFBLFNBQUQsQ0FBQSxDQUNKLEVBQUMsS0FBRCxFQURJLENBQ0csU0FBQyxLQUFEO2FBQ0wsS0FBQSxDQUFNLG9CQUFBLEdBQXFCLEtBQTNCO0lBREssQ0FESDtXQUlOLElBQUMsQ0FBQSxJQUFELENBQUE7RUFOaUIsQ0FBTDtBQXhKZCIsInNvdXJjZXNDb250ZW50IjpbIiAgICBzZWVtID0gcmVxdWlyZSAnc2VlbSdcbiAgICBQb3VjaERCID0gcmVxdWlyZSAnY2NucTQtcG91Y2hkYidcbiAgICBMUlUgPSByZXF1aXJlICdscnUnXG5cbiAgICBAbmFtZSA9IChyZXF1aXJlICcuL3BhY2thZ2UnKS5uYW1lXG4gICAgZGVidWcgPSAocmVxdWlyZSAnZGVidWcnKSBAbmFtZVxuXG4gICAgQGluY2x1ZGUgPSAtPlxuXG4gICAgICByZXR1cm4gdW5sZXNzIEBjZmcudXNlcnM/LmRiP1xuXG4gICAgICBwcmVmaXggPSBAY2ZnLnVzZXJzLnByZWZpeCA/PSAnb3JnLmNvdWNoZGIudXNlcidcblxuICAgICAgdXNlcl9kYiA9IG5ldyBQb3VjaERCIEBjZmcudXNlcnMuZGJcblxuKiBkb2MudXNlci5faWQgKHN0cmluZykgYDxjZmcudXNlcnMucHJlZml4Pjo8Y291Y2hkYl91c2VybmFtZT5gXG5cbiAgICAgIHVzZXJzID0gbmV3IExSVSA1MDBcblxuICAgICAgQGhlbHBlciBnZXRfdXNlcjogLT5cbiAgICAgICAgdW5sZXNzIEBzZXNzaW9uLmNvdWNoZGJfdXNlcm5hbWU/XG4gICAgICAgICAgcmV0dXJuIG51bGxcblxuICAgICAgICBuYW1lID0gQHNlc3Npb24uY291Y2hkYl91c2VybmFtZVxuICAgICAgICBfaWQgPSBbcHJlZml4LG5hbWVdLmpvaW4gJzonXG4gICAgICAgIGRlYnVnICdnZXRfdXNlcicsIHtuYW1lLF9pZH1cblxuICAgICAgICBkYXRhID0gdXNlcnMuZ2V0IF9pZFxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlIGRhdGEgaWYgZGF0YT9cblxuICAgICAgICB1c2VyX2RiXG4gICAgICAgICAgLmdldCBfaWRcbiAgICAgICAgICAuY2F0Y2ggLT4ge19pZCxuYW1lLHJvbGVzOltdLHR5cGU6J3VzZXInfVxuICAgICAgICAgIC50aGVuIChkYXRhKSAtPlxuICAgICAgICAgICAgdXNlcnMuc2V0IF9pZCwgZGF0YVxuICAgICAgICAgICAgZGF0YVxuXG4gICAgICBAaGVscGVyIHNhdmVfdXNlcjogc2VlbSAtPlxuICAgICAgICB1bmxlc3MgQHNlc3Npb24uY291Y2hkYl91c2VybmFtZT9cbiAgICAgICAgICByZXR1cm4ge31cblxuICAgICAgICBkb2MgPSB5aWVsZCBAZ2V0X3VzZXIoKVxuXG4gICAgICAgIGNoYW5nZXMgPSBmYWxzZVxuXG4gICAgICAgIGNoYW5nZXMgb3I9IGRvYy5sb2NhbGUgaXNudCBAc2Vzc2lvbi5sb2NhbGVcbiAgICAgICAgZG9jLmxvY2FsZSA9IEBzZXNzaW9uLmxvY2FsZVxuXG4gICAgICAgIGNoYW5nZXMgb3I9IGRvYy50aW1lem9uZSBpc250IEBzZXNzaW9uLnRpbWV6b25lXG4gICAgICAgIGRvYy50aW1lem9uZSA9IEBzZXNzaW9uLnRpbWV6b25lXG5cbiAgICAgICAgaWYgbm90IGRvYy5kYXRhYmFzZT8gYW5kIEBzZXNzaW9uLmRhdGFiYXNlP1xuICAgICAgICAgIGNoYW5nZXMgb3I9IGRvYy5kYXRhYmFzZSBpc250IEBzZXNzaW9uLmRhdGFiYXNlXG4gICAgICAgICAgZG9jLmRhdGFiYXNlID0gQHNlc3Npb24uZGF0YWJhc2VcblxuICAgICAgICBpZiBAc2Vzc2lvbi51c2VyX3BhcmFtcz9cbiAgICAgICAgICBkb2MucGFyYW1zID89IHt9XG4gICAgICAgICAgZm9yIG93biBrLHYgb2YgQHNlc3Npb24udXNlcl9wYXJhbXNcbiAgICAgICAgICAgIGNoYW5nZXMgb3I9IGRvYy5wYXJhbXNba10gaXNudCB2XG4gICAgICAgICAgICBkb2MucGFyYW1zW2tdID0gdlxuXG4gICAgICAgIGRlYnVnICdzYXZlX3VzZXInLCBkb2NcblxuICAgICAgICByZXR1cm4gaWYgbm90IGNoYW5nZXNcblxuICAgICAgICB1c2VyX2RiXG4gICAgICAgICAgLnB1dCBkb2NcblxuICAgICAgQGhlbHBlciBsb2FkX3VzZXI6IHNlZW0gLT5cbiAgICAgICAgdW5sZXNzIEBzZXNzaW9uPy5jb3VjaGRiX3VzZXJuYW1lP1xuICAgICAgICAgIHJldHVyblxuXG4gICAgICAgIHVubGVzcyBAY2ZnLnVzZXJzPy5kYj9cbiAgICAgICAgICByZXR1cm5cblxuUmV0cmlldmUgQ291Y2hEQiBkYXRhIChsb2NhbGUsIHRpbWV6b25lLCBleHRyYSByb2xlcykgZm9yIHRoZSB1c2VyLlxuXG4qIGNmZy51c2Vycy5kYiAoVVJJKSBQb2ludHMgdG8gdGhlIGB1c2Vyc2AgZGF0YWJhc2UsIGluY2x1ZGluZyBhdXRoZW50aWNhdGlvbi5cbiogY2ZnLnVzZXJzLnByZWZpeCAoc3RyaW5nKSBQcmVmaXggZm9yIHVzZXIgSURzIFtkZWZhdWx0OiBgb3JnLmNvdWNoZGIudXNlcmBdXG5cbiAgICAgICAgZG9jID0geWllbGQgQGdldF91c2VyKClcblxuVGhlIHVzZXIgcmVjb3JkIG1pZ2h0IG5vdCBleGlzdCwgb3IgbWlnaHQgYmUgZW1wdHksIGV0Yy5cblxuKiBkb2MudXNlci5sb2NhbGUgKHN0cmluZykgdXNlciBsb2NhbGVcbiogZG9jLnVzZXIudGltZXpvbmUgKHN0cmluZykgdXNlciB0aW1lem9uZVxuKiBkb2MudXNlci5kYXRhYmFzZSAoc3RyaW5nKSB1c2VyIGRhdGFiYXNlXG4qIGRvYy51c2VyLnJvbGVzIChhcnJheSkgdXNlciByb2xlc1xuKiBkb2MudXNlci5wYXJhbXMgKG9iamVjdCkgdXNlciBwZXJzb25hbGlzYXRpb24gcGFyYW1ldGVycyAoYmV5b25kIGRvYy51c2VyLmxvY2FsZSBhbmQgZG9jLnVzZXIudGltZXpvbmUpXG4qIHNlc3Npb24ubG9jYWxlIHVzZXIgbG9jYWxlOyBpbml0aWFsaXplZCBmcm9tIGRvYy51c2VyLmxvY2FsZVxuKiBzZXNzaW9uLnRpbWV6b25lIHVzZXIgdGltZXpvbmU7IGluaXRpYWxpemVkIGZyb20gZG9jLnVzZXIudGltZXpvbmVcbiogc2Vzc2lvbi5kYXRhYmFzZSB1c2VyIHByaXZhdGUgZGF0YWJhc2U7IGluaXRpYWxpemVkIGZyb20gZG9jLnVzZXIuZGF0YWJhc2Vcbiogc2Vzc2lvbi51c2VyX3BhcmFtcyB1c2VyIHBlcnNvbmFsaXphdGlvbiBwYXJhbWV0ZXJzOyBpbml0aWFsaXplZCBmcm9tIGRvYy51c2VyLnBhcmFtc1xuKiBzZXNzaW9uLmNvdWNoZGJfcm9sZXMgZXh0ZW5kZWQgYnkgZG9jLnVzZXIucm9sZXMgKGJleW9uZCB0aGUgcm9sZXMgYXV0b21hdGljYWxseSBhc3NpZ25lZCBlbHNld2hlcmUpXG5cbiAgICAgICAgQHNlc3Npb24ubG9jYWxlID89IGRvYy5sb2NhbGVcbiAgICAgICAgQHNlc3Npb24udGltZXpvbmUgPz0gZG9jLnRpbWV6b25lXG4gICAgICAgIEBzZXNzaW9uLmRhdGFiYXNlID89IGRvYy5kYXRhYmFzZVxuICAgICAgICBAc2Vzc2lvbi51c2VyX3BhcmFtcyA/PSBkb2MucGFyYW1zXG4gICAgICAgIGlmIGRvYy5yb2xlcz9cbiAgICAgICAgICBAc2Vzc2lvbi5jb3VjaGRiX3JvbGVzID89IFtdXG4gICAgICAgICAgZm9yIHIgaW4gZG9jLnJvbGVzIHdoZW4gciBub3QgaW4gQHNlc3Npb24uY291Y2hkYl9yb2xlc1xuICAgICAgICAgICAgQHNlc3Npb24uY291Y2hkYl9yb2xlcy5wdXNoIHJcblxuICAgICAgICByZXR1cm5cblxuVXNlciBwYXJhbWV0ZXJzXG4tLS0tLS0tLS0tLS0tLS1cblxuICAgICAgQG9uICdzZXRfdXNlcl9wYXJhbScsIHNlZW0gKG5hbWUsdmFsdWUpIC0+XG4gICAgICAgIHVubGVzcyBuYW1lPyBhbmQgdHlwZW9mIG5hbWUgaXMgJ3N0cmluZydcbiAgICAgICAgICBAYWNrIGZhaWxlZDp0cnVlXG4gICAgICAgICAgcmV0dXJuXG5cbiAgICAgICAgQHNlc3Npb24udXNlcl9wYXJhbXMgPz0ge31cbiAgICAgICAgQHNlc3Npb24udXNlcl9wYXJhbXNbbmFtZV0gPSB2YWx1ZVxuICAgICAgICByZXMgPSB5aWVsZCBAc2F2ZV91c2VyKCkuY2F0Y2gge31cbiAgICAgICAgQGFjayBpZiByZXMub2sgdGhlbiBvazp0cnVlIGVsc2UgZmFpbGVkOnRydWVcblxuTG9jYWxlXG4tLS0tLS1cblxuICAgICAgQG9uICdzZXRfbG9jYWxlJywgc2VlbSAobG9jYWxlKSAtPlxuICAgICAgICBAc2Vzc2lvbi5sb2NhbGUgPSBsb2NhbGVcbiAgICAgICAgcmVzID0geWllbGQgQHNhdmVfdXNlcigpLmNhdGNoIHt9XG4gICAgICAgIEBhY2sgaWYgcmVzLm9rIHRoZW4gb2s6dHJ1ZSBlbHNlIGZhaWxlZDp0cnVlXG5cbiAgICAgIEBwdXQgJy9sb2NhbGUvOmxvY2FsZScsIHNlZW0gLT5cbiAgICAgICAge2xvY2FsZX0gPSBAcGFyYW1zXG4gICAgICAgIEBzZXNzaW9uLmxvY2FsZSA9IGxvY2FsZVxuICAgICAgICByZXMgPSB5aWVsZCBAc2F2ZV91c2VyKCkuY2F0Y2gge31cbiAgICAgICAgQGpzb24gaWYgcmVzLm9rIHRoZW4gb2s6dHJ1ZSBlbHNlIGZhaWxlZDp0cnVlXG5cblRpbWV6b25lXG4tLS0tLS0tLVxuXG4gICAgICBAb24gJ3NldF90aW1lem9uZScsIHNlZW0gKHRpbWV6b25lKSAtPlxuICAgICAgICBAc2Vzc2lvbi50aW1lem9uZSA9IHRpbWV6b25lXG4gICAgICAgIHJlcyA9IHlpZWxkIEBzYXZlX3VzZXIoKS5jYXRjaCB7fVxuICAgICAgICBAYWNrIGlmIHJlcy5vayB0aGVuIG9rOnRydWUgZWxzZSBmYWlsZWQ6dHJ1ZVxuXG4gICAgICBAcHV0ICcvdGltZXpvbmUvOnRpbWV6b25lJywgc2VlbSAtPlxuICAgICAgICB7dGltZXpvbmV9ID0gQHBhcmFtc1xuICAgICAgICBAc2Vzc2lvbi50aW1lem9uZSA9IHRpbWV6b25lXG4gICAgICAgIHJlcyA9IHlpZWxkIEBzYXZlX3VzZXIoKS5jYXRjaCB7fVxuICAgICAgICBAanNvbiBpZiByZXMub2sgdGhlbiBvazp0cnVlIGVsc2UgZmFpbGVkOnRydWVcblxuTWlkZGxld2FyZVxuPT09PT09PT09PVxuXG5JbmplY3QgYGxvY2FsZWAsIGB0aW1lem9uZWAsIGBkYXRhYmFzZWAsIGFuZCBgdXNlcl9wYXJhbXNgIGludG8gdGhlIHNlc3Npb24uXG5cbiAgICBAbWlkZGxld2FyZSA9IHNlZW0gLT5cblxuICAgICAgeWllbGQgQGxvYWRfdXNlcigpXG4gICAgICAgIC5jYXRjaCAoZXJyb3IpIC0+XG4gICAgICAgICAgZGVidWcgXCJsb2FkX3VzZXIgZmFpbGVkOiAje2Vycm9yfVwiXG5cbiAgICAgIEBuZXh0KClcbiJdfQ==
//# sourceURL=/srv/home/stephane/Artisan/Managed/Telecoms/spicy-action-user/index.coffee.md