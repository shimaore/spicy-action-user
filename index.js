// Generated by CoffeeScript 1.12.7
(function() {
  var PouchDB, debug, seem,
    hasProp = {}.hasOwnProperty,
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  seem = require('seem');

  PouchDB = require('pouchdb-core').plugin(require('pouchdb-adapter-http'));

  this.name = (require('./package')).name;

  debug = (require('debug'))(this.name);

  this.include = function() {
    var base, prefix, ref, user_db;
    if (((ref = this.cfg.users) != null ? ref.db : void 0) == null) {
      return;
    }
    prefix = (base = this.cfg.users).prefix != null ? base.prefix : base.prefix = 'org.couchdb.user';
    user_db = new PouchDB(this.cfg.users.db);
    this.helper({
      get_user: function() {
        var _id, name;
        if (this.session.couchdb_username == null) {
          return null;
        }
        name = this.session.couchdb_username;
        _id = [prefix, name].join(':');
        debug('get_user', {
          name: name,
          _id: _id
        });
        return user_db.get(_id)["catch"](function() {
          return {
            _id: _id,
            name: name,
            roles: [],
            type: 'user'
          };
        });
      }
    });
    this.helper({
      save_user: seem(function*() {
        var doc, k, ref1, v;
        if (this.session.couchdb_username == null) {
          return {};
        }
        doc = (yield this.get_user());
        doc.locale = this.session.locale;
        doc.timezone = this.session.timezone;
        if ((doc.database == null) && (this.session.database != null)) {
          doc.database = this.session.database;
        }
        if (this.session.user_params != null) {
          if (doc.params == null) {
            doc.params = {};
          }
          ref1 = this.session.user_params;
          for (k in ref1) {
            if (!hasProp.call(ref1, k)) continue;
            v = ref1[k];
            doc.params[k] = v;
          }
        }
        debug('save_user', doc);
        return user_db.put(doc);
      })
    });
    this.helper({
      load_user: seem(function*() {
        var base1, base2, base3, base4, base5, doc, i, len, r, ref1, ref2, ref3;
        if (((ref1 = this.session) != null ? ref1.couchdb_username : void 0) == null) {
          return;
        }
        if (((ref2 = this.cfg.users) != null ? ref2.db : void 0) == null) {
          return;
        }
        doc = (yield this.get_user());
        if ((base1 = this.session).locale == null) {
          base1.locale = doc.locale;
        }
        if ((base2 = this.session).timezone == null) {
          base2.timezone = doc.timezone;
        }
        if ((base3 = this.session).database == null) {
          base3.database = doc.database;
        }
        if ((base4 = this.session).user_params == null) {
          base4.user_params = doc.params;
        }
        if (doc.roles != null) {
          if ((base5 = this.session).couchdb_roles == null) {
            base5.couchdb_roles = [];
          }
          ref3 = doc.roles;
          for (i = 0, len = ref3.length; i < len; i++) {
            r = ref3[i];
            if (indexOf.call(this.session.couchdb_roles, r) < 0) {
              this.session.couchdb_roles.push(r);
            }
          }
        }
      })
    });
    this.on('set_user_param', seem(function*(name, value) {
      var base1, res;
      if (!((name != null) && typeof name === 'string')) {
        this.ack({
          failed: true
        });
        return;
      }
      if ((base1 = this.session).user_params == null) {
        base1.user_params = {};
      }
      this.session.user_params[name] = value;
      res = (yield this.save_user()["catch"]({}));
      return this.ack(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
    this.on('set_locale', seem(function*(locale) {
      var res;
      this.session.locale = locale;
      res = (yield this.save_user()["catch"]({}));
      return this.ack(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
    this.put('/locale/:locale', seem(function*() {
      var res;
      this.session.locale = this.params.locale;
      res = (yield this.save_user()["catch"]({}));
      return this.json(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
    this.on('set_timezone', seem(function*(timezone) {
      var res;
      this.session.timezone = timezone;
      res = (yield this.save_user()["catch"]({}));
      return this.ack(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
    return this.put('/timezone/:timezone', seem(function*() {
      var res;
      this.session.timezone = this.params.locale;
      res = (yield this.save_user()["catch"]({}));
      return this.json(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
  };

  this.middleware = seem(function*() {
    yield this.load_user()["catch"](function(error) {
      return debug("load_user failed: " + error);
    });
    return this.next();
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC5jb2ZmZWUubWQiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFJO0FBQUEsTUFBQSxvQkFBQTtJQUFBOzs7RUFBQSxJQUFBLEdBQU8sT0FBQSxDQUFRLE1BQVI7O0VBQ1AsT0FBQSxHQUFVLE9BQUEsQ0FBUSxjQUFSLENBQ1IsQ0FBQyxNQURPLENBQ0EsT0FBQSxDQUFRLHNCQUFSLENBREE7O0VBR1YsSUFBQyxDQUFBLElBQUQsR0FBUSxDQUFDLE9BQUEsQ0FBUSxXQUFSLENBQUQsQ0FBcUIsQ0FBQzs7RUFDOUIsS0FBQSxHQUFRLENBQUMsT0FBQSxDQUFRLE9BQVIsQ0FBRCxDQUFBLENBQWtCLElBQUMsQ0FBQSxJQUFuQjs7RUFFUixJQUFDLENBQUEsT0FBRCxHQUFXLFNBQUE7QUFFVCxRQUFBO0lBQUEsSUFBYywwREFBZDtBQUFBLGFBQUE7O0lBRUEsTUFBQSxnREFBbUIsQ0FBQyxhQUFELENBQUMsU0FBVTtJQUU5QixPQUFBLEdBQVUsSUFBSSxPQUFKLENBQVksSUFBQyxDQUFBLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBdkI7SUFJVixJQUFDLENBQUEsTUFBRCxDQUFRO01BQUEsUUFBQSxFQUFVLFNBQUE7QUFDaEIsWUFBQTtRQUFBLElBQU8scUNBQVA7QUFDRSxpQkFBTyxLQURUOztRQUdBLElBQUEsR0FBTyxJQUFDLENBQUEsT0FBTyxDQUFDO1FBQ2hCLEdBQUEsR0FBTSxDQUFDLE1BQUQsRUFBUSxJQUFSLENBQWEsQ0FBQyxJQUFkLENBQW1CLEdBQW5CO1FBQ04sS0FBQSxDQUFNLFVBQU4sRUFBa0I7VUFBQyxNQUFBLElBQUQ7VUFBTSxLQUFBLEdBQU47U0FBbEI7ZUFDQSxPQUNFLENBQUMsR0FESCxDQUNPLEdBRFAsQ0FFRSxFQUFDLEtBQUQsRUFGRixDQUVTLFNBQUE7aUJBQUc7WUFBQyxLQUFBLEdBQUQ7WUFBSyxNQUFBLElBQUw7WUFBVSxLQUFBLEVBQU0sRUFBaEI7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QUEsRUFBRyxJQUFIO09BQWYsR0FBNEI7UUFBQSxNQUFBLEVBQU8sSUFBUDtPQUFsQztJQUgrQixDQUFMLENBQTVCO0VBakhTOztFQTJIWCxJQUFDLENBQUEsVUFBRCxHQUFjLElBQUEsQ0FBSyxVQUFBO0lBRWpCLE1BQU0sSUFBQyxDQUFBLFNBQUQsQ0FBQSxDQUNKLEVBQUMsS0FBRCxFQURJLENBQ0csU0FBQyxLQUFEO2FBQ0wsS0FBQSxDQUFNLG9CQUFBLEdBQXFCLEtBQTNCO0lBREssQ0FESDtXQUlOLElBQUMsQ0FBQSxJQUFELENBQUE7RUFOaUIsQ0FBTDtBQWxJZCIsInNvdXJjZXNDb250ZW50IjpbIiAgICBzZWVtID0gcmVxdWlyZSAnc2VlbSdcbiAgICBQb3VjaERCID0gcmVxdWlyZSAncG91Y2hkYi1jb3JlJ1xuICAgICAgLnBsdWdpbiByZXF1aXJlICdwb3VjaGRiLWFkYXB0ZXItaHR0cCdcblxuICAgIEBuYW1lID0gKHJlcXVpcmUgJy4vcGFja2FnZScpLm5hbWVcbiAgICBkZWJ1ZyA9IChyZXF1aXJlICdkZWJ1ZycpIEBuYW1lXG5cbiAgICBAaW5jbHVkZSA9IC0+XG5cbiAgICAgIHJldHVybiB1bmxlc3MgQGNmZy51c2Vycz8uZGI/XG5cbiAgICAgIHByZWZpeCA9IEBjZmcudXNlcnMucHJlZml4ID89ICdvcmcuY291Y2hkYi51c2VyJ1xuXG4gICAgICB1c2VyX2RiID0gbmV3IFBvdWNoREIgQGNmZy51c2Vycy5kYlxuXG4qIGRvYy51c2VyLl9pZCAoc3RyaW5nKSBgPGNmZy51c2Vycy5wcmVmaXg+Ojxjb3VjaGRiX3VzZXJuYW1lPmBcblxuICAgICAgQGhlbHBlciBnZXRfdXNlcjogLT5cbiAgICAgICAgdW5sZXNzIEBzZXNzaW9uLmNvdWNoZGJfdXNlcm5hbWU/XG4gICAgICAgICAgcmV0dXJuIG51bGxcblxuICAgICAgICBuYW1lID0gQHNlc3Npb24uY291Y2hkYl91c2VybmFtZVxuICAgICAgICBfaWQgPSBbcHJlZml4LG5hbWVdLmpvaW4gJzonXG4gICAgICAgIGRlYnVnICdnZXRfdXNlcicsIHtuYW1lLF9pZH1cbiAgICAgICAgdXNlcl9kYlxuICAgICAgICAgIC5nZXQgX2lkXG4gICAgICAgICAgLmNhdGNoIC0+IHtfaWQsbmFtZSxyb2xlczpbXSx0eXBlOid1c2VyJ31cblxuICAgICAgQGhlbHBlciBzYXZlX3VzZXI6IHNlZW0gLT5cbiAgICAgICAgdW5sZXNzIEBzZXNzaW9uLmNvdWNoZGJfdXNlcm5hbWU/XG4gICAgICAgICAgcmV0dXJuIHt9XG5cbiAgICAgICAgZG9jID0geWllbGQgQGdldF91c2VyKClcblxuICAgICAgICBkb2MubG9jYWxlID0gQHNlc3Npb24ubG9jYWxlXG4gICAgICAgIGRvYy50aW1lem9uZSA9IEBzZXNzaW9uLnRpbWV6b25lXG4gICAgICAgIGlmIG5vdCBkb2MuZGF0YWJhc2U/IGFuZCBAc2Vzc2lvbi5kYXRhYmFzZT9cbiAgICAgICAgICBkb2MuZGF0YWJhc2UgPSBAc2Vzc2lvbi5kYXRhYmFzZVxuICAgICAgICBpZiBAc2Vzc2lvbi51c2VyX3BhcmFtcz9cbiAgICAgICAgICBkb2MucGFyYW1zID89IHt9XG4gICAgICAgICAgZm9yIG93biBrLHYgb2YgQHNlc3Npb24udXNlcl9wYXJhbXNcbiAgICAgICAgICAgIGRvYy5wYXJhbXNba10gPSB2XG5cbiAgICAgICAgZGVidWcgJ3NhdmVfdXNlcicsIGRvY1xuXG4gICAgICAgIHVzZXJfZGJcbiAgICAgICAgICAucHV0IGRvY1xuXG4gICAgICBAaGVscGVyIGxvYWRfdXNlcjogc2VlbSAtPlxuICAgICAgICB1bmxlc3MgQHNlc3Npb24/LmNvdWNoZGJfdXNlcm5hbWU/XG4gICAgICAgICAgcmV0dXJuXG5cbiAgICAgICAgdW5sZXNzIEBjZmcudXNlcnM/LmRiP1xuICAgICAgICAgIHJldHVyblxuXG5SZXRyaWV2ZSBDb3VjaERCIGRhdGEgKGxvY2FsZSwgdGltZXpvbmUsIGV4dHJhIHJvbGVzKSBmb3IgdGhlIHVzZXIuXG5cbiogY2ZnLnVzZXJzLmRiIChVUkkpIFBvaW50cyB0byB0aGUgYHVzZXJzYCBkYXRhYmFzZSwgaW5jbHVkaW5nIGF1dGhlbnRpY2F0aW9uLlxuKiBjZmcudXNlcnMucHJlZml4IChzdHJpbmcpIFByZWZpeCBmb3IgdXNlciBJRHMgW2RlZmF1bHQ6IGBvcmcuY291Y2hkYi51c2VyYF1cblxuICAgICAgICBkb2MgPSB5aWVsZCBAZ2V0X3VzZXIoKVxuXG5UaGUgdXNlciByZWNvcmQgbWlnaHQgbm90IGV4aXN0LCBvciBtaWdodCBiZSBlbXB0eSwgZXRjLlxuXG4qIGRvYy51c2VyLmxvY2FsZSAoc3RyaW5nKSB1c2VyIGxvY2FsZVxuKiBkb2MudXNlci50aW1lem9uZSAoc3RyaW5nKSB1c2VyIHRpbWV6b25lXG4qIGRvYy51c2VyLmRhdGFiYXNlIChzdHJpbmcpIHVzZXIgZGF0YWJhc2VcbiogZG9jLnVzZXIucm9sZXMgKGFycmF5KSB1c2VyIHJvbGVzXG4qIGRvYy51c2VyLnBhcmFtcyAob2JqZWN0KSB1c2VyIHBlcnNvbmFsaXNhdGlvbiBwYXJhbWV0ZXJzIChiZXlvbmQgZG9jLnVzZXIubG9jYWxlIGFuZCBkb2MudXNlci50aW1lem9uZSlcbiogc2Vzc2lvbi5sb2NhbGUgdXNlciBsb2NhbGU7IGluaXRpYWxpemVkIGZyb20gZG9jLnVzZXIubG9jYWxlXG4qIHNlc3Npb24udGltZXpvbmUgdXNlciB0aW1lem9uZTsgaW5pdGlhbGl6ZWQgZnJvbSBkb2MudXNlci50aW1lem9uZVxuKiBzZXNzaW9uLmRhdGFiYXNlIHVzZXIgcHJpdmF0ZSBkYXRhYmFzZTsgaW5pdGlhbGl6ZWQgZnJvbSBkb2MudXNlci5kYXRhYmFzZVxuKiBzZXNzaW9uLnVzZXJfcGFyYW1zIHVzZXIgcGVyc29uYWxpemF0aW9uIHBhcmFtZXRlcnM7IGluaXRpYWxpemVkIGZyb20gZG9jLnVzZXIucGFyYW1zXG4qIHNlc3Npb24uY291Y2hkYl9yb2xlcyBleHRlbmRlZCBieSBkb2MudXNlci5yb2xlcyAoYmV5b25kIHRoZSByb2xlcyBhdXRvbWF0aWNhbGx5IGFzc2lnbmVkIGVsc2V3aGVyZSlcblxuICAgICAgICBAc2Vzc2lvbi5sb2NhbGUgPz0gZG9jLmxvY2FsZVxuICAgICAgICBAc2Vzc2lvbi50aW1lem9uZSA/PSBkb2MudGltZXpvbmVcbiAgICAgICAgQHNlc3Npb24uZGF0YWJhc2UgPz0gZG9jLmRhdGFiYXNlXG4gICAgICAgIEBzZXNzaW9uLnVzZXJfcGFyYW1zID89IGRvYy5wYXJhbXNcbiAgICAgICAgaWYgZG9jLnJvbGVzP1xuICAgICAgICAgIEBzZXNzaW9uLmNvdWNoZGJfcm9sZXMgPz0gW11cbiAgICAgICAgICBmb3IgciBpbiBkb2Mucm9sZXMgd2hlbiByIG5vdCBpbiBAc2Vzc2lvbi5jb3VjaGRiX3JvbGVzXG4gICAgICAgICAgICBAc2Vzc2lvbi5jb3VjaGRiX3JvbGVzLnB1c2ggclxuXG4gICAgICAgIHJldHVyblxuXG5Vc2VyIHBhcmFtZXRlcnNcbi0tLS0tLS0tLS0tLS0tLVxuXG4gICAgICBAb24gJ3NldF91c2VyX3BhcmFtJywgc2VlbSAobmFtZSx2YWx1ZSkgLT5cbiAgICAgICAgdW5sZXNzIG5hbWU/IGFuZCB0eXBlb2YgbmFtZSBpcyAnc3RyaW5nJ1xuICAgICAgICAgIEBhY2sgZmFpbGVkOnRydWVcbiAgICAgICAgICByZXR1cm5cblxuICAgICAgICBAc2Vzc2lvbi51c2VyX3BhcmFtcyA/PSB7fVxuICAgICAgICBAc2Vzc2lvbi51c2VyX3BhcmFtc1tuYW1lXSA9IHZhbHVlXG4gICAgICAgIHJlcyA9IHlpZWxkIEBzYXZlX3VzZXIoKS5jYXRjaCB7fVxuICAgICAgICBAYWNrIGlmIHJlcy5vayB0aGVuIG9rOnRydWUgZWxzZSBmYWlsZWQ6dHJ1ZVxuXG5Mb2NhbGVcbi0tLS0tLVxuXG4gICAgICBAb24gJ3NldF9sb2NhbGUnLCBzZWVtIChsb2NhbGUpIC0+XG4gICAgICAgIEBzZXNzaW9uLmxvY2FsZSA9IGxvY2FsZVxuICAgICAgICByZXMgPSB5aWVsZCBAc2F2ZV91c2VyKCkuY2F0Y2gge31cbiAgICAgICAgQGFjayBpZiByZXMub2sgdGhlbiBvazp0cnVlIGVsc2UgZmFpbGVkOnRydWVcblxuICAgICAgQHB1dCAnL2xvY2FsZS86bG9jYWxlJywgc2VlbSAtPlxuICAgICAgICBAc2Vzc2lvbi5sb2NhbGUgPSBAcGFyYW1zLmxvY2FsZVxuICAgICAgICByZXMgPSB5aWVsZCBAc2F2ZV91c2VyKCkuY2F0Y2gge31cbiAgICAgICAgQGpzb24gaWYgcmVzLm9rIHRoZW4gb2s6dHJ1ZSBlbHNlIGZhaWxlZDp0cnVlXG5cblRpbWV6b25lXG4tLS0tLS0tLVxuXG4gICAgICBAb24gJ3NldF90aW1lem9uZScsIHNlZW0gKHRpbWV6b25lKSAtPlxuICAgICAgICBAc2Vzc2lvbi50aW1lem9uZSA9IHRpbWV6b25lXG4gICAgICAgIHJlcyA9IHlpZWxkIEBzYXZlX3VzZXIoKS5jYXRjaCB7fVxuICAgICAgICBAYWNrIGlmIHJlcy5vayB0aGVuIG9rOnRydWUgZWxzZSBmYWlsZWQ6dHJ1ZVxuXG4gICAgICBAcHV0ICcvdGltZXpvbmUvOnRpbWV6b25lJywgc2VlbSAtPlxuICAgICAgICBAc2Vzc2lvbi50aW1lem9uZSA9IEBwYXJhbXMubG9jYWxlXG4gICAgICAgIHJlcyA9IHlpZWxkIEBzYXZlX3VzZXIoKS5jYXRjaCB7fVxuICAgICAgICBAanNvbiBpZiByZXMub2sgdGhlbiBvazp0cnVlIGVsc2UgZmFpbGVkOnRydWVcblxuTWlkZGxld2FyZVxuPT09PT09PT09PVxuXG5JbmplY3QgYGxvY2FsZWAsIGB0aW1lem9uZWAsIGBkYXRhYmFzZWAsIGFuZCBgdXNlcl9wYXJhbXNgIGludG8gdGhlIHNlc3Npb24uXG5cbiAgICBAbWlkZGxld2FyZSA9IHNlZW0gLT5cblxuICAgICAgeWllbGQgQGxvYWRfdXNlcigpXG4gICAgICAgIC5jYXRjaCAoZXJyb3IpIC0+XG4gICAgICAgICAgZGVidWcgXCJsb2FkX3VzZXIgZmFpbGVkOiAje2Vycm9yfVwiXG5cbiAgICAgIEBuZXh0KClcbiJdfQ==
//# sourceURL=/srv/home/stephane/Artisan/Managed/Telecoms/spicy-action-user/index.coffee.md