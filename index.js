// Generated by CoffeeScript 1.12.7
(function() {
  var PouchDB, debug, seem,
    hasProp = {}.hasOwnProperty,
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  seem = require('seem');

  PouchDB = require('pouchdb');

  this.name = (require('./package')).name;

  debug = (require('debug'))(this.name);

  this.include = function() {
    var base, prefix, ref, user_db;
    if (((ref = this.cfg.users) != null ? ref.db : void 0) == null) {
      return;
    }
    prefix = (base = this.cfg.users).prefix != null ? base.prefix : base.prefix = 'org.couchdb.user';
    user_db = new PouchDB(this.cfg.users.db);
    this.helper({
      get_user: function() {
        var _id, name;
        if (this.session.couchdb_username == null) {
          return null;
        }
        name = this.session.couchdb_username;
        _id = [prefix, name].join(':');
        debug('get_user', {
          name: name,
          _id: _id
        });
        return user_db.get(_id)["catch"](function() {
          return {
            _id: _id,
            name: name,
            roles: [],
            type: 'user'
          };
        });
      }
    });
    this.helper({
      save_user: seem(function*() {
        var doc, k, ref1, v;
        if (this.session.couchdb_username == null) {
          return {};
        }
        doc = (yield this.get_user());
        doc.locale = this.session.locale;
        doc.timezone = this.session.timezone;
        if ((doc.database == null) && (this.session.database != null)) {
          doc.database = this.session.database;
        }
        if (this.session.user_params != null) {
          if (doc.params == null) {
            doc.params = {};
          }
          ref1 = this.session.user_params;
          for (k in ref1) {
            if (!hasProp.call(ref1, k)) continue;
            v = ref1[k];
            doc.params[k] = v;
          }
        }
        debug('save_user', doc);
        return user_db.put(doc);
      })
    });
    this.helper({
      load_user: seem(function*() {
        var base1, base2, base3, base4, base5, doc, i, len, r, ref1, ref2, ref3;
        if (((ref1 = this.session) != null ? ref1.couchdb_username : void 0) == null) {
          return;
        }
        if (((ref2 = this.cfg.users) != null ? ref2.db : void 0) == null) {
          return;
        }
        doc = (yield this.get_user());
        if ((base1 = this.session).locale == null) {
          base1.locale = doc.locale;
        }
        if ((base2 = this.session).timezone == null) {
          base2.timezone = doc.timezone;
        }
        if ((base3 = this.session).database == null) {
          base3.database = doc.database;
        }
        if ((base4 = this.session).user_params == null) {
          base4.user_params = doc.params;
        }
        if (doc.roles != null) {
          if ((base5 = this.session).couchdb_roles == null) {
            base5.couchdb_roles = [];
          }
          ref3 = doc.roles;
          for (i = 0, len = ref3.length; i < len; i++) {
            r = ref3[i];
            if (indexOf.call(this.session.couchdb_roles, r) < 0) {
              this.session.couchdb_roles.push(r);
            }
          }
        }
      })
    });
    this.on('set_user_param', seem(function*(name, value) {
      var base1, res;
      if (!((name != null) && typeof name === 'string')) {
        this.ack({
          failed: true
        });
        return;
      }
      if ((base1 = this.session).user_params == null) {
        base1.user_params = {};
      }
      this.session.user_params[name] = value;
      res = (yield this.save_user()["catch"]({}));
      return this.ack(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
    this.on('set_locale', seem(function*(locale) {
      var res;
      this.session.locale = locale;
      res = (yield this.save_user()["catch"]({}));
      return this.ack(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
    this.put('/locale/:locale', seem(function*() {
      var res;
      this.session.locale = this.params.locale;
      res = (yield this.save_user()["catch"]({}));
      return this.json(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
    this.on('set_timezone', seem(function*(timezone) {
      var res;
      this.session.timezone = timezone;
      res = (yield this.save_user()["catch"]({}));
      return this.ack(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
    return this.put('/timezone/:timezone', seem(function*() {
      var res;
      this.session.timezone = this.params.locale;
      res = (yield this.save_user()["catch"]({}));
      return this.json(res.ok ? {
        ok: true
      } : {
        failed: true
      });
    }));
  };

  this.middleware = seem(function*() {
    yield this.load_user()["catch"](function(error) {
      return debug("load_user failed: " + error);
    });
    return this.next();
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC5jb2ZmZWUubWQiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFJO0FBQUEsTUFBQSxvQkFBQTtJQUFBOzs7RUFBQSxJQUFBLEdBQU8sT0FBQSxDQUFRLE1BQVI7O0VBQ1AsT0FBQSxHQUFVLE9BQUEsQ0FBUSxTQUFSOztFQUVWLElBQUMsQ0FBQSxJQUFELEdBQVEsQ0FBQyxPQUFBLENBQVEsV0FBUixDQUFELENBQXFCLENBQUM7O0VBQzlCLEtBQUEsR0FBUSxDQUFDLE9BQUEsQ0FBUSxPQUFSLENBQUQsQ0FBQSxDQUFrQixJQUFDLENBQUEsSUFBbkI7O0VBRVIsSUFBQyxDQUFBLE9BQUQsR0FBVyxTQUFBO0FBRVQsUUFBQTtJQUFBLElBQWMsMERBQWQ7QUFBQSxhQUFBOztJQUVBLE1BQUEsZ0RBQW1CLENBQUMsYUFBRCxDQUFDLFNBQVU7SUFFOUIsT0FBQSxHQUFVLElBQUksT0FBSixDQUFZLElBQUMsQ0FBQSxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQXZCO0lBSVYsSUFBQyxDQUFBLE1BQUQsQ0FBUTtNQUFBLFFBQUEsRUFBVSxTQUFBO0FBQ2hCLFlBQUE7UUFBQSxJQUFPLHFDQUFQO0FBQ0UsaUJBQU8sS0FEVDs7UUFHQSxJQUFBLEdBQU8sSUFBQyxDQUFBLE9BQU8sQ0FBQztRQUNoQixHQUFBLEdBQU0sQ0FBQyxNQUFELEVBQVEsSUFBUixDQUFhLENBQUMsSUFBZCxDQUFtQixHQUFuQjtRQUNOLEtBQUEsQ0FBTSxVQUFOLEVBQWtCO1VBQUMsTUFBQSxJQUFEO1VBQU0sS0FBQSxHQUFOO1NBQWxCO2VBQ0EsT0FDRSxDQUFDLEdBREgsQ0FDTyxHQURQLENBRUUsRUFBQyxLQUFELEVBRkYsQ0FFUyxTQUFBO2lCQUFHO1lBQUMsS0FBQSxHQUFEO1lBQUssTUFBQSxJQUFMO1lBQVUsS0FBQSxFQUFNLEVBQWhCO1lBQW1CLElBQUEsRUFBSyxNQUF4Qjs7UUFBSCxDQUZUO01BUGdCLENB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QVA7T0FBbEM7SUFIK0IsQ0FBTCxDQUE1QjtFQWpIUzs7RUEySFgsSUFBQyxDQUFBLFVBQUQsR0FBYyxJQUFBLENBQUssVUFBQTtJQUVqQixNQUFNLElBQUMsQ0FBQSxTQUFELENBQUEsQ0FDSixFQUFDLEtBQUQsRUFESSxDQUNHLFNBQUMsS0FBRDthQUNMLEtBQUEsQ0FBTSxvQkFBQSxHQUFxQixLQUEzQjtJQURLLENBREg7V0FJTixJQUFDLENBQUEsSUFBRCxDQUFBO0VBTmlCLENBQUw7QUFqSWQiLCJzb3VyY2VzQ29udGVudCI6WyIgICAgc2VlbSA9IHJlcXVpcmUgJ3NlZW0nXG4gICAgUG91Y2hEQiA9IHJlcXVpcmUgJ3BvdWNoZGInXG5cbiAgICBAbmFtZSA9IChyZXF1aXJlICcuL3BhY2thZ2UnKS5uYW1lXG4gICAgZGVidWcgPSAocmVxdWlyZSAnZGVidWcnKSBAbmFtZVxuXG4gICAgQGluY2x1ZGUgPSAtPlxuXG4gICAgICByZXR1cm4gdW5sZXNzIEBjZmcudXNlcnM/LmRiP1xuXG4gICAgICBwcmVmaXggPSBAY2ZnLnVzZXJzLnByZWZpeCA/PSAnb3JnLmNvdWNoZGIudXNlcidcblxuICAgICAgdXNlcl9kYiA9IG5ldyBQb3VjaERCIEBjZmcudXNlcnMuZGJcblxuKiBkb2MudXNlci5faWQgKHN0cmluZykgYDxjZmcudXNlcnMucHJlZml4Pjo8Y291Y2hkYl91c2VybmFtZT5gXG5cbiAgICAgIEBoZWxwZXIgZ2V0X3VzZXI6IC0+XG4gICAgICAgIHVubGVzcyBAc2Vzc2lvbi5jb3VjaGRiX3VzZXJuYW1lP1xuICAgICAgICAgIHJldHVybiBudWxsXG5cbiAgICAgICAgbmFtZSA9IEBzZXNzaW9uLmNvdWNoZGJfdXNlcm5hbWVcbiAgICAgICAgX2lkID0gW3ByZWZpeCxuYW1lXS5qb2luICc6J1xuICAgICAgICBkZWJ1ZyAnZ2V0X3VzZXInLCB7bmFtZSxfaWR9XG4gICAgICAgIHVzZXJfZGJcbiAgICAgICAgICAuZ2V0IF9pZFxuICAgICAgICAgIC5jYXRjaCAtPiB7X2lkLG5hbWUscm9sZXM6W10sdHlwZTondXNlcid9XG5cbiAgICAgIEBoZWxwZXIgc2F2ZV91c2VyOiBzZWVtIC0+XG4gICAgICAgIHVubGVzcyBAc2Vzc2lvbi5jb3VjaGRiX3VzZXJuYW1lP1xuICAgICAgICAgIHJldHVybiB7fVxuXG4gICAgICAgIGRvYyA9IHlpZWxkIEBnZXRfdXNlcigpXG5cbiAgICAgICAgZG9jLmxvY2FsZSA9IEBzZXNzaW9uLmxvY2FsZVxuICAgICAgICBkb2MudGltZXpvbmUgPSBAc2Vzc2lvbi50aW1lem9uZVxuICAgICAgICBpZiBub3QgZG9jLmRhdGFiYXNlPyBhbmQgQHNlc3Npb24uZGF0YWJhc2U/XG4gICAgICAgICAgZG9jLmRhdGFiYXNlID0gQHNlc3Npb24uZGF0YWJhc2VcbiAgICAgICAgaWYgQHNlc3Npb24udXNlcl9wYXJhbXM/XG4gICAgICAgICAgZG9jLnBhcmFtcyA/PSB7fVxuICAgICAgICAgIGZvciBvd24gayx2IG9mIEBzZXNzaW9uLnVzZXJfcGFyYW1zXG4gICAgICAgICAgICBkb2MucGFyYW1zW2tdID0gdlxuXG4gICAgICAgIGRlYnVnICdzYXZlX3VzZXInLCBkb2NcblxuICAgICAgICB1c2VyX2RiXG4gICAgICAgICAgLnB1dCBkb2NcblxuICAgICAgQGhlbHBlciBsb2FkX3VzZXI6IHNlZW0gLT5cbiAgICAgICAgdW5sZXNzIEBzZXNzaW9uPy5jb3VjaGRiX3VzZXJuYW1lP1xuICAgICAgICAgIHJldHVyblxuXG4gICAgICAgIHVubGVzcyBAY2ZnLnVzZXJzPy5kYj9cbiAgICAgICAgICByZXR1cm5cblxuUmV0cmlldmUgQ291Y2hEQiBkYXRhIChsb2NhbGUsIHRpbWV6b25lLCBleHRyYSByb2xlcykgZm9yIHRoZSB1c2VyLlxuXG4qIGNmZy51c2Vycy5kYiAoVVJJKSBQb2ludHMgdG8gdGhlIGB1c2Vyc2AgZGF0YWJhc2UsIGluY2x1ZGluZyBhdXRoZW50aWNhdGlvbi5cbiogY2ZnLnVzZXJzLnByZWZpeCAoc3RyaW5nKSBQcmVmaXggZm9yIHVzZXIgSURzIFtkZWZhdWx0OiBgb3JnLmNvdWNoZGIudXNlcmBdXG5cbiAgICAgICAgZG9jID0geWllbGQgQGdldF91c2VyKClcblxuVGhlIHVzZXIgcmVjb3JkIG1pZ2h0IG5vdCBleGlzdCwgb3IgbWlnaHQgYmUgZW1wdHksIGV0Yy5cblxuKiBkb2MudXNlci5sb2NhbGUgKHN0cmluZykgdXNlciBsb2NhbGVcbiogZG9jLnVzZXIudGltZXpvbmUgKHN0cmluZykgdXNlciB0aW1lem9uZVxuKiBkb2MudXNlci5kYXRhYmFzZSAoc3RyaW5nKSB1c2VyIGRhdGFiYXNlXG4qIGRvYy51c2VyLnJvbGVzIChhcnJheSkgdXNlciByb2xlc1xuKiBkb2MudXNlci5wYXJhbXMgKG9iamVjdCkgdXNlciBwZXJzb25hbGlzYXRpb24gcGFyYW1ldGVycyAoYmV5b25kIGRvYy51c2VyLmxvY2FsZSBhbmQgZG9jLnVzZXIudGltZXpvbmUpXG4qIHNlc3Npb24ubG9jYWxlIHVzZXIgbG9jYWxlOyBpbml0aWFsaXplZCBmcm9tIGRvYy51c2VyLmxvY2FsZVxuKiBzZXNzaW9uLnRpbWV6b25lIHVzZXIgdGltZXpvbmU7IGluaXRpYWxpemVkIGZyb20gZG9jLnVzZXIudGltZXpvbmVcbiogc2Vzc2lvbi5kYXRhYmFzZSB1c2VyIHByaXZhdGUgZGF0YWJhc2U7IGluaXRpYWxpemVkIGZyb20gZG9jLnVzZXIuZGF0YWJhc2Vcbiogc2Vzc2lvbi51c2VyX3BhcmFtcyB1c2VyIHBlcnNvbmFsaXphdGlvbiBwYXJhbWV0ZXJzOyBpbml0aWFsaXplZCBmcm9tIGRvYy51c2VyLnBhcmFtc1xuKiBzZXNzaW9uLmNvdWNoZGJfcm9sZXMgZXh0ZW5kZWQgYnkgZG9jLnVzZXIucm9sZXMgKGJleW9uZCB0aGUgcm9sZXMgYXV0b21hdGljYWxseSBhc3NpZ25lZCBlbHNld2hlcmUpXG5cbiAgICAgICAgQHNlc3Npb24ubG9jYWxlID89IGRvYy5sb2NhbGVcbiAgICAgICAgQHNlc3Npb24udGltZXpvbmUgPz0gZG9jLnRpbWV6b25lXG4gICAgICAgIEBzZXNzaW9uLmRhdGFiYXNlID89IGRvYy5kYXRhYmFzZVxuICAgICAgICBAc2Vzc2lvbi51c2VyX3BhcmFtcyA/PSBkb2MucGFyYW1zXG4gICAgICAgIGlmIGRvYy5yb2xlcz9cbiAgICAgICAgICBAc2Vzc2lvbi5jb3VjaGRiX3JvbGVzID89IFtdXG4gICAgICAgICAgZm9yIHIgaW4gZG9jLnJvbGVzIHdoZW4gciBub3QgaW4gQHNlc3Npb24uY291Y2hkYl9yb2xlc1xuICAgICAgICAgICAgQHNlc3Npb24uY291Y2hkYl9yb2xlcy5wdXNoIHJcblxuICAgICAgICByZXR1cm5cblxuVXNlciBwYXJhbWV0ZXJzXG4tLS0tLS0tLS0tLS0tLS1cblxuICAgICAgQG9uICdzZXRfdXNlcl9wYXJhbScsIHNlZW0gKG5hbWUsdmFsdWUpIC0+XG4gICAgICAgIHVubGVzcyBuYW1lPyBhbmQgdHlwZW9mIG5hbWUgaXMgJ3N0cmluZydcbiAgICAgICAgICBAYWNrIGZhaWxlZDp0cnVlXG4gICAgICAgICAgcmV0dXJuXG5cbiAgICAgICAgQHNlc3Npb24udXNlcl9wYXJhbXMgPz0ge31cbiAgICAgICAgQHNlc3Npb24udXNlcl9wYXJhbXNbbmFtZV0gPSB2YWx1ZVxuICAgICAgICByZXMgPSB5aWVsZCBAc2F2ZV91c2VyKCkuY2F0Y2gge31cbiAgICAgICAgQGFjayBpZiByZXMub2sgdGhlbiBvazp0cnVlIGVsc2UgZmFpbGVkOnRydWVcblxuTG9jYWxlXG4tLS0tLS1cblxuICAgICAgQG9uICdzZXRfbG9jYWxlJywgc2VlbSAobG9jYWxlKSAtPlxuICAgICAgICBAc2Vzc2lvbi5sb2NhbGUgPSBsb2NhbGVcbiAgICAgICAgcmVzID0geWllbGQgQHNhdmVfdXNlcigpLmNhdGNoIHt9XG4gICAgICAgIEBhY2sgaWYgcmVzLm9rIHRoZW4gb2s6dHJ1ZSBlbHNlIGZhaWxlZDp0cnVlXG5cbiAgICAgIEBwdXQgJy9sb2NhbGUvOmxvY2FsZScsIHNlZW0gLT5cbiAgICAgICAgQHNlc3Npb24ubG9jYWxlID0gQHBhcmFtcy5sb2NhbGVcbiAgICAgICAgcmVzID0geWllbGQgQHNhdmVfdXNlcigpLmNhdGNoIHt9XG4gICAgICAgIEBqc29uIGlmIHJlcy5vayB0aGVuIG9rOnRydWUgZWxzZSBmYWlsZWQ6dHJ1ZVxuXG5UaW1lem9uZVxuLS0tLS0tLS1cblxuICAgICAgQG9uICdzZXRfdGltZXpvbmUnLCBzZWVtICh0aW1lem9uZSkgLT5cbiAgICAgICAgQHNlc3Npb24udGltZXpvbmUgPSB0aW1lem9uZVxuICAgICAgICByZXMgPSB5aWVsZCBAc2F2ZV91c2VyKCkuY2F0Y2gge31cbiAgICAgICAgQGFjayBpZiByZXMub2sgdGhlbiBvazp0cnVlIGVsc2UgZmFpbGVkOnRydWVcblxuICAgICAgQHB1dCAnL3RpbWV6b25lLzp0aW1lem9uZScsIHNlZW0gLT5cbiAgICAgICAgQHNlc3Npb24udGltZXpvbmUgPSBAcGFyYW1zLmxvY2FsZVxuICAgICAgICByZXMgPSB5aWVsZCBAc2F2ZV91c2VyKCkuY2F0Y2gge31cbiAgICAgICAgQGpzb24gaWYgcmVzLm9rIHRoZW4gb2s6dHJ1ZSBlbHNlIGZhaWxlZDp0cnVlXG5cbk1pZGRsZXdhcmVcbj09PT09PT09PT1cblxuSW5qZWN0IGBsb2NhbGVgLCBgdGltZXpvbmVgLCBgZGF0YWJhc2VgLCBhbmQgYHVzZXJfcGFyYW1zYCBpbnRvIHRoZSBzZXNzaW9uLlxuXG4gICAgQG1pZGRsZXdhcmUgPSBzZWVtIC0+XG5cbiAgICAgIHlpZWxkIEBsb2FkX3VzZXIoKVxuICAgICAgICAuY2F0Y2ggKGVycm9yKSAtPlxuICAgICAgICAgIGRlYnVnIFwibG9hZF91c2VyIGZhaWxlZDogI3tlcnJvcn1cIlxuXG4gICAgICBAbmV4dCgpXG4iXX0=
//# sourceURL=/srv/home/stephane/Artisan/Managed/Telecoms/spicy-action-user/index.coffee.md